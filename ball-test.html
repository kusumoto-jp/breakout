<html>
  <head>
    <title>Breakout</title>
    <style type="text/css">
      canvas {
        display: block;
        margin: auto;
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <canvas id='canvas' width='300' height='300'></canvas>
  </body>
  <script>
      var cs  = document.getElementById('canvas');
      var ctx = cs.getContext('2d');
      var currentBall, bar;

      function Ball() {
          this.speedX = 3.0;
          this.speedY = 5.0;
          this.currentX = 200;
          this.currentY = 150;
      }

      function init() {
          // currentBall = new Ball();
          bar = new Bar();
          // setInterval("draw(currentBall)", 30);
      }

      function draw(ball){
          ctx.fillStyle = "white";
          ctx.fillRect(0, 0, cs.width, cs.height);

          //位置を更新
          ball.currentX += ball.speedX;
          ball.currentY += ball.speedY;

          if(ball.currentX < 0 || ball.currentX > cs.width){
              ball.speedX *= -1;
          }

          if(ball.currentY < 0 || ball.currentY > cs.height){
              ball.speedY *= -1;
          }

          //更新した座標で円を描く
          ctx.beginPath();
          ctx.fillStyle = 'blue';
          ctx.arc(ball.currentX, ball.currentY, 4, 0, Math.PI*2.0, true);
          ctx.fill();
      }

      function Bar() {
          this.x = 100;
          this.y = 100;
          this.display = cs.height-20;
          this.width = 100;
          this.height = 8;
          ctx.fillRect(this.x, this.display, this.width, this.height);

          this.moveLeft = function() {
              if (this.isMovable(-10)) this.draw();
          }
          this.moveRight = function() {
              if (this.isMovable(+10)) this.draw();
          }
          this.draw = function() {
              ctx.clearRect(0, 0, cs.width, cs.height);
              ctx.fillRect(this.x, this.display, this.width, this.height);
          }
          this.isMovable = function(direction) {
              var moveX = this.x + direction;
              if (moveX <= cs.width - this.width && moveX >= 0) {
                  this.x += direction;
                  return true;
              }
              return false;
          }
      }

      document.onkeydown = function (e) {
          keyCode = e.keyCode;
          switch (keyCode) {
              case 37:
                  bar.moveLeft();
                  break;
              case 39:
                  bar.moveRight();
                  break;
          }
      }

      init();
  </script>
</html>
